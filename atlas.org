#+BEGIN_SRC ipython :session :results output
  import matplotlib.pyplot as plt
  from scipy.spatial import Voronoi, voronoi_plot_2d
  %matplotlib inline
  import numpy as np
  from atlas import Atlas
#+END_SRC

#+RESULTS:

#+BEGIN_SRC ipython :session :file vor.png :exports both
  atlas = Atlas(dimensions=(20, 20), granularity=128)
  atlas.generate_voronoi()
  voronoi_plot_2d(atlas.vor)
  plt.show()
#+END_SRC

#+RESULTS:
[[file:vor.png]]


#+BEGIN_SRC ipython :session :file vor_relaxed.png :exports both
  vert = atlas.vor.vertices
  import sys
  eps = sys.float_info.epsilon
  def get_centroid(vertices):
      signed_area = 0
      C_x = 0
      C_y = 0
      for i in range(len(vertices)-1):
          step = (vertices[i, 0]*vertices[i+1, 1])-(vertices[i+1, 0]*vertices[i, 1])
          signed_area += step
          C_x += (vertices[i, 0] + vertices[i+1, 0])*step
          C_y += (vertices[i, 1] + vertices[i+1, 1])*step

      signed_area = 1/2*signed_area
      C_x = (1.0/(6.0*signed_area))*C_x
      C_y = (1.0/(6.0*signed_area))*C_y
      return np.array([[C_x, C_y]])

  filtered_regions = []
  bounding_box = [0, 20, 0, 20] #x_min, x_max, y_min, y_max
  for region in atlas.vor.regions:
      flag = True
      for index in region:
          if index == -1:
              flag = False
              break
          else:
              x = atlas.vor.vertices[index, 0]
              y = atlas.vor.vertices[index, 1]
              if not(bounding_box[0] - eps <= x and x <= bounding_box[1] + eps and
                         bounding_box[2] - eps <= y and y <= bounding_box[3] + eps):
                      flag = False
                      break
      if region != [] and flag:
          filtered_regions.append(region)


  centroids = []
  for region in filtered_regions:
      vertices = atlas.vor.vertices[region + [region[0]], :]
      centroid = get_centroid(vertices)
      centroids.append(list(centroid[0, :]))
  rel = Voronoi(centroids)
  voronoi_plot_2d(rel)
  plt.show()
#+END_SRC

#+RESULTS:
[[file:vor_relaxed.png]]


#+BEGIN_SRC ipython :session :file relaxed_p2.png :exports both
#+END_SRC



#+BEGIN_SRC ipython :session :file vor_relaxed.png :exports both
  rel = Voronoi(atlas.vor.vertices)
  voronoi_plot_2d(rel)
  plt.show()
#+END_SRC

#+RESULTS:
[[file:vor_relaxed.png]]


#+BEGIN_SRC ipython :session :results output :exports both
  print(rel.points)
#+END_SRC

#+RESULTS:
#+begin_example
[[  5.33422785e+00   1.92639605e-01]
 [  1.12040944e+00   1.59107073e+01]
 [  2.29555370e+00   1.65470160e+01]
 [  7.46770648e-01   9.65212475e+00]
 [ -1.79946109e+01   9.95471126e+00]
 [  2.26730837e+01   1.24584190e+01]
 [  1.87269514e+01   3.82092866e+00]
 [  1.90434415e+01   1.14666010e+01]
 [  1.92260977e+01   1.14537924e+01]
 [  1.80172030e+01   5.36430841e+00]
 [  1.74090078e+01   5.36095050e+00]
 [ -3.87422947e+01  -4.93479336e+00]
 [ -5.78799511e+00   2.95249304e+00]
 [  2.86820514e+00   2.70254632e+00]
 [  3.49133522e+00   1.55862742e+00]
 [  3.41218024e+00   1.59084792e+00]
 [  6.32332778e+00   1.41475969e+00]
 [  8.27114246e+00   2.07091049e+00]
 [  1.30474380e+01   4.92471137e+00]
 [  8.61210436e+00   2.06282453e+00]
 [  3.41648990e+00   6.77681114e+00]
 [  1.57162999e+01   5.46808823e+00]
 [  1.48548518e+01   6.91558068e+00]
 [  1.67411349e+01   5.83194829e+00]
 [  1.88475570e+01   1.63238518e+00]
 [  1.31902198e+01   4.81803586e+00]
 [  1.41084173e+01   3.00053701e+00]
 [  1.56196329e+01   5.24120657e+00]
 [  1.58466202e+01   8.59166824e+00]
 [  1.62348590e+01   1.05698187e+01]
 [  1.63093068e+01   1.03470762e+01]
 [  1.64825051e+00   1.32366793e+01]
 [ -1.12394032e+00   1.22204716e+01]
 [  1.38322973e+00   1.02680091e+01]
 [  2.27704123e+00   1.08120141e+01]
 [  8.06023915e-01   1.16649582e+01]
 [  1.87096039e+01   9.18687994e+00]
 [  1.73910275e+01   9.69047846e+00]
 [  1.67220744e+01   7.69265930e+00]
 [  1.66097140e+01   6.94529751e+00]
 [  1.68253026e+01   6.08490142e+00]
 [  3.83473860e+00   5.35765806e+00]
 [  3.20969961e+00   5.08336091e+00]
 [  4.09123662e+00   3.52551965e+00]
 [  3.17493721e+00   5.07841573e+00]
 [  1.76362346e+00   7.44062712e+00]
 [  9.20179928e-01   4.61233659e+00]
 [  2.10680796e+00   4.48270539e+00]
 [  1.04622354e+01   2.76775970e-01]
 [  1.46015245e+01  -4.18328929e+01]
 [  9.75275676e+00   3.29249643e+00]
 [  2.01360486e+00   8.23475149e+00]
 [  2.37978267e+00   7.58971679e+00]
 [  2.14496578e+00   7.62134244e+00]
 [  2.06092719e+00   7.67178539e+00]
 [  1.81444918e+01   3.27587632e+00]
 [  1.80983638e+01   3.00438352e+00]
 [  1.71982813e+01   4.01517648e+00]
 [  1.65478294e+01   2.25734718e+00]
 [  1.58273837e+01   4.00860844e+00]
 [  1.56634707e+01   3.68706781e+00]
 [  2.65561903e+00   1.65305333e+01]
 [  1.77556640e+01   1.30685985e+01]
 [  1.83334168e+01   1.36556239e+01]
 [  1.86488397e+01   5.89859954e+00]
 [  1.95897847e+01   8.42642521e+00]
 [  3.10028428e+01   6.59517639e+00]
 [  2.46967126e+01   5.64757260e+00]
 [  1.75794523e+01   7.76717086e+00]
 [  1.72542270e+01   7.65215747e+00]
 [  1.85069454e+01   7.70711628e+00]
 [  1.75675020e+01   6.63151730e+00]
 [  1.81717311e+01   6.69414396e+00]
 [  4.93165136e+00   5.58616345e+00]
 [  5.51089397e+00   6.52803721e+00]
 [  5.84676897e+00   3.83435297e+00]
 [  5.65446418e+00   4.05379183e+00]
 [  1.17990989e+01   2.49283264e+00]
 [  1.07051315e+01   5.22992061e-01]
 [  1.10948410e+01   4.24945539e+00]
 [  9.84974110e+00   3.29094430e+00]
 [  1.19064167e+01   3.73459843e+00]
 [  1.16479196e+01   2.76601737e+00]
 [  1.13419011e+01   6.32400268e+00]
 [  1.10238660e+01   4.68934566e+00]
 [  9.64024971e+00   4.12066701e+00]
 [  3.65799475e+00   7.71361119e+00]
 [  4.48068580e+00   7.58373217e+00]
 [  4.38648293e+00   7.58398295e+00]
 [  1.30112360e+01   9.83124759e+00]
 [  1.20601887e+01   6.73868513e+00]
 [  1.23385845e+01   6.57772446e+00]
 [  1.46210264e+01   7.18630963e+00]
 [  1.49526137e+01   7.83360277e+00]
 [  1.56971777e+01   1.43325101e+01]
 [  1.61263185e+01   1.24059719e+01]
 [  1.56847559e+01   1.12310747e+01]
 [  1.44704439e+01   1.12229977e+01]
 [  3.11855278e+00   1.71039425e+01]
 [  7.98808377e+00   1.86631713e+01]
 [  3.63695019e+00   1.58103476e+01]
 [  1.65427618e+00   1.32316300e+01]
 [  1.88450583e+00   1.20292295e+01]
 [  2.49078190e+00   1.11055387e+01]
 [  6.17024122e+00   6.78563648e+00]
 [  9.16211032e+00   5.77614771e+00]
 [  9.13594187e+00   5.68448334e+00]
 [  1.63839757e+01   1.77615640e+00]
 [  1.26678754e+01   2.29314685e+00]
 [  1.31253215e+01   7.72542181e-01]
 [  1.28594537e+01   1.01969885e+00]
 [  1.40620785e+01   2.84836764e+00]
 [  1.40882527e+01   2.79187063e+00]
 [  3.45797098e+00   8.87603162e+00]
 [  2.79366861e+00   9.67235732e+00]
 [  2.59017184e+00   8.72213218e+00]
 [  1.14964867e+01   9.02114686e+00]
 [  1.15419523e+01   9.12187953e+00]
 [  5.81648198e+00   9.75542906e+00]
 [  1.37112998e+01   1.20062727e+01]
 [  1.29677228e+01   1.31407095e+01]
 [  1.43923022e+01   1.43167195e+01]
 [  1.39486332e+01   1.44659185e+01]
 [  8.44543404e+00   2.01529863e+01]
 [  1.19243974e+01   1.85515225e+01]
 [  7.66254976e+00   1.50308046e+01]
 [  6.00600419e+00   1.48548360e+01]
 [  4.73501652e+00   1.77494687e+01]
 [  4.13640023e+00   1.44924803e+01]
 [  2.84519392e+00   1.32775335e+01]
 [  6.18579574e+00   1.03664682e+01]
 [  1.83080213e+01   1.37842635e+01]
 [  1.86218336e+01   1.47668258e+01]
 [  6.91647945e+00   4.44109914e+00]
 [  6.95895145e+00   5.37249264e+00]
 [  7.86052629e+00   4.38824115e+00]
 [  8.36489121e+00   5.07031165e+00]
 [  1.52380219e+01  -1.57457035e+01]
 [  1.33993996e+01  -4.07546963e-02]
 [  1.64812601e+01  -4.57041590e-01]
 [  1.62854260e+01   9.98346602e-02]
 [  1.40218894e+01   1.56273573e+00]
 [  1.42500455e+01   2.08336390e+00]
 [  1.41735843e+01   9.28074774e-01]
 [  1.62132725e+01   1.56719679e-01]
 [  3.58487157e+00   9.66530614e+00]
 [  5.14560333e+00   9.68498929e+00]
 [  4.53009680e+00   9.18080464e+00]
 [  4.08003816e+00   9.21028250e+00]
 [  1.01783135e+01   8.87934265e+00]
 [  8.45169693e+00   6.69483595e+00]
 [  7.01315920e+00   7.43958305e+00]
 [  7.02909119e+00   7.84645243e+00]
 [  8.62927440e+00   1.08550610e+01]
 [  7.69418871e+00   1.05110960e+01]
 [  7.32328659e+00   1.02987226e+01]
 [  8.84082098e+00   9.33213570e+00]
 [  8.19583104e+00   9.03239118e+00]
 [  1.23935396e+01   1.46719144e+01]
 [  1.29144012e+01   1.63224535e+01]
 [  1.32596217e+01   1.52534797e+01]
 [  1.32830620e+01   1.54289478e+01]
 [  1.06259877e+01   1.71956402e+01]
 [  1.16384254e+01   1.83969998e+01]
 [  1.06888504e+01   1.85653513e+01]
 [  7.69244801e+00   1.51774601e+01]
 [  7.91314891e+00   1.83252567e+01]
 [  6.80073167e+00   1.79319318e+01]
 [  5.72315453e+00   1.43165129e+01]
 [  4.83144427e+00   1.39033967e+01]
 [  8.07987232e+00   1.29150886e+01]
 [  7.73012690e+00   1.36832841e+01]
 [  1.93194056e+01   1.69470362e+02]
 [  1.25860995e+01   4.63989728e+01]
 [  4.93527792e+00   1.88457242e+01]
 [  6.26529725e+00   1.83168481e+01]
 [  4.13038088e+00   1.96329152e+01]
 [  3.86344556e+00   2.19624104e+01]
 [  5.48759756e+00   1.99553949e+01]
 [  3.19581004e+00   1.27328357e+01]
 [  3.88311345e+00   1.12137867e+01]
 [  4.29522575e+00   1.16962326e+01]
 [  4.33415897e+00   1.25393445e+01]
 [  2.93317847e+00   1.11896115e+01]
 [  3.29531909e+00   1.11348400e+01]
 [  1.62345578e+01   1.55586655e+01]
 [  1.62422686e+01   1.55687490e+01]
 [  1.40281114e+01   1.57137601e+01]
 [  1.16217746e+01   1.22298563e+01]
 [  1.28953612e+01   1.25873452e+01]
 [  1.28974016e+01   1.25664481e+01]
 [  1.10399347e+01   1.46094298e+01]
 [  1.06793545e+01   1.46703647e+01]
 [  1.04689392e+01   1.44573857e+01]
 [  1.09234672e+01   1.07558779e+01]
 [  1.09449457e+01   1.14318292e+01]
 [  8.64262424e+00   1.08887894e+01]
 [  8.26579586e+00   1.28546531e+01]
 [  8.89767360e+00   1.30047076e+01]
 [  1.06832903e+01   1.70860638e+01]
 [  1.10257767e+01   1.55592797e+01]
 [  1.18155150e+01   1.67225529e+01]
 [  1.21179537e+01   1.62825335e+01]
 [  8.32623564e+00   1.58553844e+01]
 [  1.05279934e+01   1.45853177e+01]
 [  1.05419894e+01   1.45971332e+01]
 [  9.38148504e+00   1.72709907e+01]
 [  8.49496294e+00   1.75993700e+01]
 [  8.49203304e+00   1.76000361e+01]
 [  5.99970989e+00   1.56232700e+01]
 [  6.91826238e+00   1.56727496e+01]
 [  5.39642431e+00   1.62663459e+01]
 [  6.36554761e+00   1.75287281e+01]
 [  6.53183039e+00   1.76397068e+01]
 [  4.73038846e+00   1.32282012e+01]
 [  4.86542785e+00   1.37410660e+01]
 [  5.90951383e+00   1.15556080e+01]
 [  6.22301353e+00   1.14377071e+01]
 [  6.96902055e+00   1.23156053e+01]
 [  6.98876657e+00   1.23419796e+01]
 [  2.05210796e+01   1.61290921e+01]
 [  6.85310721e+01   1.43634056e+01]
 [  1.72965882e+01   1.58869875e+01]
 [  1.63494134e+01   1.58507190e+01]
 [  1.91362000e+01   1.66145698e+01]
 [  1.80742225e+01   1.83062151e+01]
 [  1.31802180e+01   1.70660418e+01]
 [  1.43119574e+01   1.63871156e+01]
 [  1.40205754e+01   1.68047121e+01]
 [  1.62596063e+01   1.61913287e+01]
 [  1.48505263e+01   1.63843576e+01]
 [  1.43000516e+01   1.69028524e+01]
 [  1.61957369e+01   1.69644375e+01]
 [  1.51115666e+01   1.73799083e+01]
 [  1.32217882e+01   2.08520869e+01]
 [  1.29298201e+01   1.93132638e+01]
 [  1.29921777e+01   1.91556579e+01]
 [  1.60633027e+01   1.83101425e+01]
 [  1.64352634e+01   1.74989284e+01]
 [  1.75712289e+01   2.19642456e+01]
 [  1.79624154e+01   1.83665835e+01]]
#+end_example

